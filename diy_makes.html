<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OBJECTS & DIY</title>
  <link rel="stylesheet" href="styles/global.css" />
  <style>
    body {
      font-family: Helvetica, Arial, sans-serif;
      background: #fff;
      margin: 0;
      padding: 0
    }

    #globalNav {
      width: 100%
    }

    h1.page-title {
      text-align: center;
      font-size: 2rem;
      margin: 50px auto 20px;
      font-weight: bold;
      letter-spacing: .05em;
      max-width: 750px;
      padding: 0 20px
    }

    #itemsContainer {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 60px 80px
    }

    .year-section {
      margin-bottom: 80px
    }

    .year-header {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 30px;
      letter-spacing: 0.05em;
    }

    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 50px;

      max-width: 900px;
      /* adjust to taste */
      margin: 0 auto;
      /* centers the grid */
    }

    .grid-item {
      text-align: center
    }

    .grid-item-title {
      font-weight: bold;
      font-size: 1rem;
      margin-bottom: 2px;
      /* was 8px */
    }

    .grid-item-type {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 8px;
      /* was 12px */
      text-transform: lowercase;
    }

    .grid-item-image-container {
      position: relative;
      width: 100%;
      height: 280px;
      overflow: hidden;
      cursor: pointer;

      background: #ffffff;
      /* shelf paper */
      border: 1px solid rgba(0, 0, 0, 0.08);
      /* thin frame */
      border-radius: 2px;
    }

    .grid-item-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      /* NO crop */
      object-position: center;
      display: block;

      will-change: transform, opacity, filter;
      transform: translateZ(0);
      backface-visibility: hidden;
      transition: filter 0.25s ease, opacity 0.25s ease, transform 0.25s ease;
    }

    /* keep your hover, but make it feel like "lift off shelf" */
    .grid-item-image-container:hover .grid-item-image {
      filter: blur(3px) brightness(1.06);
      opacity: 0.75;
      transform: translateZ(0) scale(1.01);
    }

    .grid-item-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      text-align: center;
      z-index: 10;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.35s ease;
    }

    .grid-item-image-container:hover .grid-item-overlay {
      opacity: 1;
    }

    .grid-item-overlay-text {
      font-size: 14px;
      line-height: 1.3;
      color: #000;
    }

    @media (prefers-reduced-motion: reduce) {

      .grid-item-image,
      .grid-item-overlay {
        transition: none !important;
      }
    }

    @media (max-width:768px) {
      #itemsContainer {
        padding: 0 30px 80px
      }

      .items-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 30px;
      }

      .grid-item-image-container {
        height: 200px;
      }
    }
  </style>
</head>

<body>
  <div id="globalNav"></div>
  <h1 class="page-title">OBJECTS & DIY</h1>

  <div id="itemsContainer"></div>

  <script>
    // Load global nav
    fetch('components/nav.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('globalNav').innerHTML = html;
        const navScript = document.createElement('script');
        navScript.src = 'components/nav.js';
        document.body.appendChild(navScript);
      });

    // Load items
    fetch('data/diy_makes.json')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('itemsContainer');

        // Group by year
        const byYear = {};
        data.forEach(item => {
          if (!byYear[item.year]) byYear[item.year] = [];
          byYear[item.year].push(item);
        });

        // Sort years descending
        const years = Object.keys(byYear).sort((a, b) => b - a);

        years.forEach(year => {
          const section = document.createElement('div');
          section.className = 'year-section';

          const header = document.createElement('div');
          header.className = 'year-header';
          header.textContent = year;

          const grid = document.createElement('div');
          grid.className = 'items-grid';

          byYear[year].forEach(item => {
            const gridItem = document.createElement('div');
            gridItem.className = 'grid-item';

            const title = document.createElement('div');
            title.className = 'grid-item-title';
            title.textContent = item.title;

            const type = document.createElement('div');
            type.className = 'grid-item-type';
            type.textContent = item.type;

            const imageContainer = document.createElement('div');
            imageContainer.className = 'grid-item-image-container';

            const img = document.createElement('img');
            img.className = 'grid-item-image';
            img.src = item.main_image;
            img.alt = item.title;

            const overlay = document.createElement('div');
            overlay.className = 'grid-item-overlay';

            const overlayText = document.createElement('div');
            overlayText.className = 'grid-item-overlay-text';
            // Strip HTML tags for overlay preview
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = item.short_description;
            const cleanText = tempDiv.textContent || tempDiv.innerText || '';
            overlayText.textContent = cleanText.slice(0, 100) + '...';

            overlay.appendChild(overlayText);
            imageContainer.appendChild(img);
            imageContainer.appendChild(overlay);

            if (item.url) {
              imageContainer.style.cursor = 'pointer';
              imageContainer.addEventListener('click', () => {
                window.location.href = item.url;
              });
            } else {
              imageContainer.style.cursor = 'default';
            }

            gridItem.appendChild(title);
            gridItem.appendChild(type);
            gridItem.appendChild(imageContainer);

            grid.appendChild(gridItem);
          });

          section.appendChild(header);
          section.appendChild(grid);
          container.appendChild(section);
        });
      })
      .catch(err => console.error('Failed to load items:', err));
  </script>
</body>

</html>